<header class="bg-white shadow-sm sticky top-0 z-50">
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
    <a href="#" class="text-2xl font-bold text-indigo-600">PrepMaster</a>

    <!-- Desktop Menu Links -->
    @if (authService.isLoggedIn$ | async) {
    <div class="hidden lg:flex space-x-8 items-center">
      <a
        routerLink="/home"
        routerLinkActive="text-indigo-600 font-semibold"
        class="text-slate-600 hover:text-indigo-600 transition-colors"
      >
        Home
      </a>
      <a
        routerLink="/app/dashboard"
        routerLinkActive="text-indigo-600 font-semibold"
        class="text-slate-600 hover:text-indigo-600 transition-colors"
      >
        Dashboard
      </a>

      <a
        routerLink="/app/catalog"
        routerLinkActive="text-indigo-600 font-semibold"
        class="text-slate-600 hover:text-indigo-600 transition-colors"
      >
        Explore Exams
      </a>

      <a
        routerLink="/app/results"
        routerLinkActive="text-indigo-600 font-semibold"
        class="text-slate-600 hover:text-indigo-600 transition-colors"
      >
        My Results
      </a>
    </div>
    } @else {
    <div class="hidden lg:flex space-x-6 items-center">
      <a href="#features" class="text-black hover:text-indigo-600 transition-colors">Features</a>
      <a href="#exams" class="text-black hover:text-indigo-600 transition-colors">Exams</a>
      <a href="#how-it-works" class="text-black hover:text-indigo-600 transition-colors"
        >How it Works</a
      >
      <a href="#testimonials" class="text-black hover:text-indigo-600 transition-colors"
        >Testimonials</a
      >
      <a href="#pricing" class="text-black hover:text-indigo-600 transition-colors">Pricing</a>
    </div>
    }

    <!-- --- THIS IS THE CORRECTED DESKTOP AUTH SECTION --- -->

    <!-- 1. Logged-Out View (Desktop) -->
    @if (!(authService.isLoggedIn$|async)) {
    <div class="hidden lg:flex space-x-3 items-center">
      <button
        class="text-indigo-600 hover:text-indigo-800 text-sm font-medium transition-colors"
        (click)="navigateTo('/login')"
      >
        Login
      </button>
      <button
        class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors"
        (click)="navigateTo('/register')"
      >
        Sign Up
      </button>
    </div>
    }

    <!-- 2. Logged-In View (Desktop) -->
    @else { @if(authService.currentUser | async; as user) {
    <div class="hidden lg:flex items-center space-x-4">
      @if (user['is_pro_member']) {
      <div
        class="flex items-center space-x-1 px-3 py-1 bg-amber-100 text-amber-700 rounded-full border border-amber-200 shadow-sm"
      >
        <span class="text-xs font-bold">PRO</span>
      </div>
      } @else {
      <button
        class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors"
        (click)="navigateTo('/app/prices')"
      >
        Our Plans
      </button>
      }

      <span class="text-sm text-slate-600"> Welcome, {{ user.firstName || 'User' }}! </span>

      <div
        class="w-8 h-8 rounded-full bg-indigo-200 flex items-center justify-center cursor-pointer"
      >
        <span class="text-sm font-semibold text-indigo-700 uppercase">
          {{ user.firstName ? user.firstName[0] : 'U' }}
        </span>
      </div>

      <button class="text-red-500 hover:text-red-700 text-sm font-medium" (click)="logout()">
        Logout
      </button>
    </div>
    } @else {
    <div class="hidden lg:flex items-center space-x-4">
      <p-skeleton width="6rem" height="2.5rem" borderRadius="0.5rem"></p-skeleton>
      <p-skeleton width="8rem" height="1rem"></p-skeleton>
      <p-skeleton shape="circle" size="2rem"></p-skeleton>
      <p-skeleton width="4rem" height="1rem"></p-skeleton>
    </div>
    } }

    <!-- Mobile Menu Button -->
    <div class="lg:hidden">
      <button
        (click)="toggleMobileMenu()"
        class="text-slate-600 hover:text-indigo-600 focus:outline-none"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            *ngIf="!isMobileMenuOpen"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          ></path>
          <path
            *ngIf="isMobileMenuOpen"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>
  </nav>

  <!-- ---  MOBILE SIDEBAR --- -->
  @if (isMobileMenuOpen) {
  <div class="lg:hidden absolute top-full left-0 w-full bg-white shadow-lg py-4 z-40">
    <div class="container mx-auto px-4 sm:px-6">
      @if (authService.isLoggedIn$ | async) {
      <a
        routerLink="/home"
        routerLinkActive="text-indigo-600 font-semibold"
        class="block py-2 px-3 text-slate-600 hover:text-indigo-600"
        (click)="closeMobileMenu()"
      >
        Home
      </a>
      <a
        routerLink="/app/dashboard"
        routerLinkActive="text-indigo-600 font-semibold"
        class="block py-2 px-3 text-slate-600 hover:text-indigo-600"
        (click)="closeMobileMenu()"
      >
        Dashboard
      </a>
      <a
        routerLink="/app/catalog"
        routerLinkActive="text-indigo-600 font-semibold"
        class="block py-2 px-3 text-slate-600 hover:text-indigo-600"
        (click)="closeMobileMenu()"
      >
        Explore Exams
      </a>
      <a
        routerLink="/app/results"
        routerLinkActive="text-indigo-600 font-semibold"
        class="block py-2 px-3 text-slate-600 hover:text-indigo-600"
        (click)="closeMobileMenu()"
      >
        My Results
      </a>
      } @else {
      <a href="#features" class="block py-2 px-3 text-black" (click)="closeMobileMenu()"
        >Features</a
      >
      <a href="#exams" class="block py-2 px-3 text-black" (click)="closeMobileMenu()">Exams</a>
      <a href="#how-it-works" class="block py-2 px-3 text-black" (click)="closeMobileMenu()"
        >How it Works</a
      >
      <a href="#testimonials" class="block py-2 px-3 text-black" (click)="closeMobileMenu()"
        >Testimonials</a
      >
      <a href="#pricing" class="block py-2 px-3 text-black" (click)="closeMobileMenu()">Pricing</a>
      }

      <!-- 1. Logged-Out View (Mobile) -->
      @if (!(authService.isLoggedIn$ | async)) {
      <div class="border-t border-slate-200 mt-4 pt-4 flex flex-col space-y-3">
        <button
          class="w-full text-center text-indigo-600 hover:text-indigo-800 text-sm font-medium transition-colors"
          (click)="navigateTo('/login')"
        >
          Login
        </button>
        <button
          class="w-full text-center bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors"
          (click)="navigateTo('/register')"
        >
          Sign Up
        </button>
      </div>
      }

      <!-- 2. Logged-In View (Mobile) -->
      @else {
      <div class="border-t border-slate-200 mt-4 pt-4 space-y-3">
        <div class="flex items-center px-3 py-2">
          @if (authService.currentUser |async; as user) {
          <div
            class="w-8 h-8 rounded-full bg-indigo-200 flex items-center justify-center cursor-pointer"
          >
            <span class="text-sm font-semibold text-indigo-700 uppercase">
              {{ user.firstName ? user.firstName[0] : 'U' }}
            </span>
          </div>
          <span class="text-sm text-slate-600 ml-3"> Welcome, {{ user.firstName || 'User' }} </span>
          } @else {
          <p-skeleton shape="circle" size="2rem"></p-skeleton>
          <p-skeleton width="8rem" height="1rem" styleClass="ml-3"></p-skeleton>
          }
        </div>
        @if (authService.currentUser | async; as user) { @if (user['is_pro_member']) {
        <div
          class="w-full text-center bg-amber-100 text-amber-800 text-sm font-bold py-2 px-4 rounded-lg border border-amber-200"
        >
          <span class="text-xs font-bold">PRO</span>
        </div>
        } @else {
        <button
          class="w-full text-center bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors"
          (click)="navigateTo('/app/prices')"
        >
          Our Plans
        </button>
        } } @else {
        <p-skeleton width="100%" height="2.5rem" borderRadius="0.5rem"></p-skeleton>
        }
        <button
          class="w-full text-center text-red-500 hover:text-red-700 text-sm font-medium py-2 px-4 rounded-lg border border-red-500 hover:bg-red-50 transition-colors"
          (click)="logout()"
        >
          Logout
        </button>
      </div>
      }
    </div>
  </div>
  }
</header>
