<header class="bg-white border-b border-slate-200 sticky top-0 z-50">
  <nav
    class="container relative mx-auto px-4 sm:px-6 lg:px-8 h-16 flex justify-between items-center"
  >
    <!-- LEFT SIDE: Logo & Main Nav -->
    <div class="flex items-center gap-8">
      <!-- Logo -->
      <a routerLink="/" class="text-2xl font-bold text-indigo-600 flex items-center gap-2">
        <i class="pi pi-book text-xl"></i>
        <span>PrepMaster</span>
      </a>

      <!-- Desktop Nav (Logged In) -->
      @if (authService.isLoggedIn$ | async) {
      <div class="hidden lg:flex items-center gap-6 text-sm font-medium text-slate-600">
        <a
          routerLink="/app/dashboard"
          routerLinkActive="text-indigo-600 font-semibold"
          class="hover:text-indigo-600 transition-colors"
        >
          Dashboard
        </a>

        <a
          routerLink="/app/catalog"
          routerLinkActive="text-indigo-600 font-semibold"
          class="hover:text-indigo-600 transition-colors"
        >
          Explore Exams
        </a>

        <!-- Study Material Dropdown (Desktop Hover) -->
        <div class="relative group cursor-pointer h-16 flex items-center">
          <button
            class="hover:text-indigo-600 transition-colors flex items-center gap-1 focus:outline-none"
          >
            Study Material <i class="pi pi-angle-down text-xs opacity-70"></i>
          </button>

          <!-- Dropdown Body -->
          <div
            class="absolute top-14 left-0 w-56 bg-white border border-slate-100 shadow-xl rounded-xl hidden group-hover:block animate-fade-in pt-2"
          >
            <div class="flex flex-col py-2">
              <a
                routerLink="/app/coming-soon"
                class="px-4 py-2.5 hover:bg-indigo-50 hover:text-indigo-600 transition-colors flex items-center gap-2"
              >
                <i class="pi pi-file text-slate-400"></i> Previous Papers
              </a>
              <a
                routerLink="/app/coming-soon"
                class="px-4 py-2.5 hover:bg-indigo-50 hover:text-indigo-600 transition-colors flex items-center gap-2"
              >
                <i class="pi pi-globe text-slate-400"></i> Current Affairs
              </a>
              <a
                routerLink="/app/coming-soon"
                class="px-4 py-2.5 hover:bg-indigo-50 hover:text-indigo-600 transition-colors flex items-center gap-2"
              >
                <i class="pi pi-bolt text-slate-400"></i> Daily Quiz
              </a>
            </div>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- CENTER LINKS (Logged Out Only) -->
    @if ((authService.isLoggedIn$ | async) === false) {
    <div
      class="hidden lg:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 items-center gap-8 text-sm font-medium text-slate-600"
    >
      <a href="#features" class="hover:text-indigo-600 transition-colors">Features</a>
      <a href="#exams" class="hover:text-indigo-600 transition-colors">Exams</a>
      <a href="#how-it-works" class="hover:text-indigo-600 transition-colors">How It Works</a>
      <a href="#testimonials" class="hover:text-indigo-600 transition-colors">Testimonials</a>
      <a href="#pricing" class="hover:text-indigo-600 transition-colors">Pricing</a>
    </div>
    }

    <!-- RIGHT SIDE: Actions & Profile -->
    <div class="flex items-center gap-3 sm:gap-6">
      <!-- LOGGED IN VIEW -->
      <!-- Subscription Status (Desktop) -->
      @if (authService.isLoggedIn$ | async) { @if(authService.currentUser | async; as user){
      <!-- Subscription Status (Desktop) -->
      <div class="hidden md:flex items-center">
        @if(user.is_pro_active){
        <div
          class="flex items-center gap-1.5 bg-amber-100 text-amber-700 px-3 py-1.5 rounded-full text-xs font-bold border border-amber-200"
        >
          <i class="pi pi-star-fill text-[10px]"></i>
          <span>PRO</span>
        </div>
        }@else {
        <button
          routerLink="/app/prices"
          class="premium-btn px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm"
        >
          Our Plans
        </button>
        }
      </div>
      } @else {
      <div class="hidden md:flex">
        <p-skeleton width="5rem" height="2rem" borderRadius="0.5rem"></p-skeleton>
      </div>
      }

      <!-- 1. Gamification (Streak) - Hidden on tiny screens -->
      @if (authService.currentUser | async; as user) {
      <div
        class="flex items-center bg-orange-50 text-orange-600 px-3 py-1.5 rounded-full text-xs font-bold border border-orange-100 cursor-help"
        title="{{ user['streak'] }} Day Study Streak"
      >
        <img class="h-[20px] object-cover" src="assets/images/streak-img.png" alt="" />
        <span>{{ user['streak'] }}</span>
      </div>
      }

      <!-- 2. Notifications -->
      <button
        (click)="op.toggle($event)"
        class="relative p-2 text-slate-500 hover:text-indigo-600 transition-colors focus:outline-none"
      >
        <i class="pi pi-bell text-xl"></i>
        <!-- Red Dot -->
        @if(unreadCount > 0){
        <span
          class="absolute top-1.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white"
        ></span>
        }
      </button>

      <p-popover #op [style]="{ width: '350px' }">
        <div class="flex items-center justify-between mb-3 pb-2 border-b border-slate-100">
          <h3 class="font-bold text-slate-800">Notifications</h3>
          <button
            (click)="markAsRead()"
            class="text-xs text-indigo-600 hover:underline font-medium"
          >
            Mark all read
          </button>
        </div>
        <div class="max-h-[300px] overflow-y-auto space-y-2">
          @for (notif of notifications; track notif.id) {
          <div
            class="flex items-start gap-3 p-2 rounded-lg hover:bg-slate-50 transition-colors cursor-pointer"
            [ngClass]="{ 'opacity-70': notif.read }"
          >
            <div
              class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"
              [ngClass]="notif.color"
            >
              <i [class]="notif.icon + ' text-sm'"></i>
            </div>
            <div>
              <p class="text-sm font-semibold text-slate-800 leading-tight mb-0.5">
                {{ notif.title }}
                @if(!notif.read) {<span
                  class="inline-block w-1.5 h-1.5 bg-red-500 rounded-full ml-1 align-middle"
                ></span
                >}
              </p>
              <p class="text-xs text-slate-500 line-clamp-2 leading-snug">{{ notif.message }}</p>
              <p class="text-[10px] text-slate-400 mt-1">{{ notif.time }}</p>
            </div>
          </div>
          } @empty {
          <div class="text-center py-6">
            <i class="pi pi-bell-slash text-2xl text-slate-300 mb-2"></i>
            <p class="text-sm text-slate-500">No new notifications</p>
          </div>
          }
        </div>
      </p-popover>

      <!-- 3. Profile Dropdown -->
      <div class="relative">
        @if (authService.currentUser | async; as user) {
        <button
          type="button"
          (click)="userMenu.toggle($event)"
          class="flex items-center gap-2 focus:outline-none"
        >
          <!-- Avatar -->
          <div
            class="w-9 h-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white flex items-center justify-center font-bold text-sm shadow-md ring-2 ring-white hover:ring-indigo-100 transition-all"
          >
            {{ user['first_name'] ? user['first_name'][0].toUpperCase() : 'U' }}
          </div>
          <!-- Name (Hidden on Mobile) -->
          <div class="hidden md:block text-left">
            <p class="text-xs font-bold text-slate-700 leading-none">{{ user['first_name'] }}</p>
            <p class="text-[10px] text-slate-500 leading-none mt-1" *ngIf="user.is_pro_active">
              PRO Member
            </p>
          </div>
          <i class="pi pi-angle-down text-xs text-slate-400 hidden md:block"></i>
        </button>
        } @else {
        <!-- Skeleton for Avatar loading -->
        <p-skeleton shape="circle" size="2.25rem"></p-skeleton>
        }

        <!-- PrimeNG Menu -->
        <p-menu #userMenu [model]="userMenuItems" [popup]="true" appendTo="body"></p-menu>
      </div>

      } @else {
      <!-- LOGGED OUT VIEW -->

      <div class="hidden lg:flex items-center gap-3">
        <a
          routerLink="/login"
          class="text-indigo-600 font-semibold hover:text-indigo-700 text-sm px-3 py-2"
          >Login</a
        >
        <a
          routerLink="/register"
          class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold text-sm px-5 py-2.5 rounded-lg transition-colors shadow-sm shadow-indigo-200"
          >Sign Up</a
        >
      </div>
      }

      <!-- Mobile Hamburger (Visible on small screens) -->
      <button
        (click)="toggleMobileMenu()"
        class="lg:hidden p-2 text-slate-600 hover:text-indigo-600 focus:outline-none"
      >
        <i
          class="pi"
          [ngClass]="isMobileMenuOpen ? 'pi-times' : 'pi-bars'"
          style="font-size: 1.5rem"
        ></i>
      </button>
    </div>
  </nav>

  <!-- MOBILE MENU OVERLAY -->
  @if (isMobileMenuOpen) {
  <div
    class="lg:hidden absolute top-16 left-0 w-full bg-white border-t border-slate-100 shadow-2xl z-40 animate-fade-in h-[calc(100vh-4rem)] overflow-y-auto"
  >
    <div class="flex flex-col p-4 space-y-2">
      @if (authService.isLoggedIn$ | async) {

      <!-- Mobile Subscription Status -->
      @if(authService.currentUser | async; as user){
      <div class="px-4 py-2">
        @if(user.is_pro_active){
        <div
          class="flex items-center justify-center gap-2 bg-amber-50 text-amber-700 px-4 py-3 rounded-xl border border-amber-200 font-bold"
        >
          <i class="pi pi-star-fill text-sm"></i>
          <span>PRO Member</span>
        </div>
        } @else {
        <button
          routerLink="/app/prices"
          (click)="closeMobileMenu()"
          class="w-full premium-btn px-4 py-3 rounded-xl font-bold shadow-sm flex items-center justify-center gap-2"
        >
          <i class="pi pi-sparkles"></i> Upgrade to Pro
        </button>
        }
      </div>
      }
      <a
        routerLink="/app/dashboard"
        (click)="closeMobileMenu()"
        routerLinkActive="bg-indigo-50 text-indigo-700"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-colors flex items-center"
      >
        <i class="pi pi-home mr-3 text-lg"></i> Dashboard
      </a>
      <a
        routerLink="/app/catalog"
        (click)="closeMobileMenu()"
        routerLinkActive="bg-indigo-50 text-indigo-700"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-colors flex items-center"
      >
        <i class="pi pi-search mr-3 text-lg"></i> Explore Exams
      </a>

      <!-- Mobile Expandable Study Material -->
      <div class="border rounded-xl overflow-hidden">
        <button
          (click)="isStudyMenuOpen = !isStudyMenuOpen"
          class="w-full flex justify-between items-center px-4 py-3 bg-slate-50 font-medium text-slate-700"
        >
          <span class="flex items-center"
            ><i class="pi pi-book mr-3 text-lg"></i> Study Material</span
          >
          <i class="pi" [ngClass]="isStudyMenuOpen ? 'pi-chevron-up' : 'pi-chevron-down'"></i>
        </button>
        @if (isStudyMenuOpen) {
        <div class="bg-white px-4 py-2 space-y-1">
          <a
            routerLink="/app/coming-soon"
            (click)="closeMobileMenu()"
            class="block px-4 py-2 text-sm text-slate-500 hover:text-indigo-600"
            >Previous Papers</a
          >
          <a
            routerLink="/app/coming-soon"
            (click)="closeMobileMenu()"
            class="block px-4 py-2 text-sm text-slate-500 hover:text-indigo-600"
            >Current Affairs</a
          >
          <a
            routerLink="/app/coming-soon"
            (click)="closeMobileMenu()"
            class="block px-4 py-2 text-sm text-slate-500 hover:text-indigo-600"
            >Daily Quiz</a
          >
        </div>
        }
      </div>

      } @else {
      <!-- Mobile Logged Out Links -->
      <a
        href="#features"
        (click)="closeMobileMenu()"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50"
        >Features</a
      >
      <a
        href="#exams"
        (click)="closeMobileMenu()"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50"
        >Exams</a
      >
      <a
        href="#how-it-works"
        (click)="closeMobileMenu()"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50"
        >How It Works</a
      >
      <a
        href="#testimonials"
        (click)="closeMobileMenu()"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50"
        >Testimonials</a
      >
      <a
        href="#pricing"
        (click)="closeMobileMenu()"
        class="px-4 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-50"
        >Pricing</a
      >
      <div class="border-t border-slate-100 my-2 pt-4 flex flex-col gap-3">
        <button
          routerLink="/login"
          (click)="closeMobileMenu()"
          class="w-full py-3 rounded-xl border border-slate-300 font-bold text-slate-700"
        >
          Login
        </button>
        <button
          routerLink="/register"
          (click)="closeMobileMenu()"
          class="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold shadow-md"
        >
          Sign Up Free
        </button>
      </div>
      }
    </div>
  </div>
  }
</header>
