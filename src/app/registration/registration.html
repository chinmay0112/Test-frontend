<!-- ========================================== -->
<!-- 1. MODAL: ACCOUNT CREATED (SUCCESS)        -->
<!-- ========================================== -->
@if (isRegistrationSuccessful) {
<div
  class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in"
>
  <div
    class="bg-white w-full max-w-sm p-8 rounded-2xl shadow-2xl text-center transform transition-all scale-100"
  >
    <!-- Success Icon Animation -->
    <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6">
      <div
        class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center animate-bounce-slight"
      >
        <i class="pi pi-check text-3xl text-green-600 font-bold"></i>
      </div>
    </div>

    <h2 class="text-2xl font-bold text-slate-900 mb-2">Welcome Aboard!</h2>
    <p class="text-slate-500 mb-8 text-sm leading-relaxed">
      Your account has been created successfully. You are just one step away from starting your prep
      journey.
    </p>

    <button
      (click)="closeModalAndLogin()"
      class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3.5 rounded-xl transition-all shadow-md hover:shadow-lg focus:ring-4 focus:ring-indigo-100"
    >
      Continue to Login
    </button>
  </div>
</div>
}

<!-- ========================================== -->
<!-- 3. MODAL: VERIFY PHONE (OTP)               -->
<!-- ========================================== -->
@if (showOtpModal()) {
<div
  class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in"
>
  <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-2xl relative border border-slate-100">
    <!-- Close Button -->
    <button
      (click)="showOtpModal.set(false)"
      class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-2 rounded-full hover:bg-slate-50 transition-colors"
    >
      <i class="pi pi-times"></i>
    </button>

    <div class="text-center mb-8">
      <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="pi pi-mobile text-3xl text-blue-600"></i>
      </div>
      <h2 class="text-2xl font-bold text-slate-900">Verify Phone Number</h2>
      <p class="text-slate-500 text-sm mt-2">
        Enter the 6-digit code sent to <br />
        <span class="font-bold text-slate-800 text-base tracking-wide"
          >+91 {{ registrationForm.value.phone }}</span
        >
      </p>
    </div>

    <!-- OTP Input Grid -->
    <p-inputotp [(ngModel)]="otpDigits" size="large" [length]="6" />
    <!-- Timer & Resend Action -->
    <div
      class="flex justify-between items-center text-sm px-2 mb-8 bg-slate-50 p-3 rounded-lg border border-slate-100"
    >
      <span class="text-slate-500 flex items-center gap-2">
        <i class="pi pi-clock"></i>
        <span
          >Expires in:
          <span class="font-mono font-bold text-slate-700 w-10 inline-block text-center"
            >00:{{ timeLeft < 10 ? '0' + timeLeft : timeLeft }}</span
          ></span
        >
      </span>

      <button
        type="button"
        (click)="sendOtp()"
        [disabled]="!showResend"
        class="font-semibold transition-colors focus:outline-none text-xs uppercase tracking-wide"
        [ngClass]="
          showResend
            ? 'text-indigo-600 hover:text-indigo-800 cursor-pointer'
            : 'text-slate-300 cursor-not-allowed'
        "
      >
        Resend Code
      </button>
    </div>

    <!-- Verify Button -->
    <button
      type="button"
      (click)="verifyAndCreateAccount()"
      [disabled]="loading()"
      class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold py-3.5 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-200"
    >
      @if (loading()) {
      <span class="flex items-center justify-center gap-2">
        <i class="pi pi-spin pi-spinner"></i> Verifying...
      </span>
      } @else { Verify & Create Account }
    </button>
  </div>
</div>
}

<!-- ========================================== -->
<!-- 4. MAIN REGISTRATION PAGE                  -->
<!-- ========================================== -->

<div class="min-h-screen bg-gray-200 flex items-center justify-center p-4">
  <div
    class="w-full max-w-5xl bg-white rounded-2xl shadow-xl flex overflow-hidden border border-slate-100"
  >
    <!-- LEFT PANEL: Visual & Brand -->
    <div
      class="hidden lg:flex w-5/12 bg-indigo-600 p-8 flex-col justify-between relative overflow-hidden"
    >
      <!-- Background Pattern -->
      <div
        class="absolute inset-0 opacity-10 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"
      ></div>

      <div class="relative z-10">
        <div class="flex items-center gap-2 text-white/90 mb-6">
          <i class="pi pi-book text-xl"></i>
          <span class="font-bold text-lg tracking-tight">PrepMaster</span>
        </div>

        <h1 class="text-white font-extrabold text-3xl leading-tight mb-4">
          Start your journey <br />
          to <span class="text-yellow-300">Success.</span>
        </h1>

        <ul class="space-y-3 text-indigo-100 text-sm">
          <li class="flex items-center gap-3">
            <i class="pi pi-check-circle text-green-400"></i> Access 500+ Mock Tests
          </li>
          <li class="flex items-center gap-3">
            <i class="pi pi-check-circle text-green-400"></i> AI-Powered Analysis
          </li>
          <li class="flex items-center gap-3">
            <i class="pi pi-check-circle text-green-400"></i> All India Ranking
          </li>
        </ul>
      </div>

      <div class="mt-6 relative z-10">
        <img
          src="assets/images/reg-img.png"
          alt="Students Celebrating Success"
          class="w-full h-auto rounded-lg shadow-lg border-2 border-indigo-500/30 transform hover:scale-105 transition-transform duration-500"
        />
      </div>
    </div>

    <!-- RIGHT PANEL: Registration Form -->
    <div class="w-full lg:w-7/12 p-6 md:p-10 flex flex-col justify-center relative bg-white">
      <!-- Back Link -->
      <a
        routerLink="/"
        class="absolute top-6 right-6 text-xs font-semibold text-slate-400 hover:text-indigo-600 flex items-center gap-1 transition-colors"
      >
        <i class="pi pi-arrow-left text-[10px]"></i> Back to Home
      </a>

      <div class="max-w-md mx-auto w-full">
        <!-- Form Header -->
        <div class="mb-6">
          <h2 class="text-2xl font-extrabold text-slate-900 mb-1">Create Account</h2>
          <p class="text-slate-500 text-sm">Join thousands of students acing their exams.</p>
        </div>

        <!-- The Form -->
        <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
          <!-- Name Row -->
          <div class="grid grid-cols-2 gap-3 mb-7">
            <div class="space-y-1">
              <label
                for="firstName"
                class="block text-[10px] font-bold text-slate-600 uppercase tracking-wider"
                >First Name</label
              >
              <div class="relative">
                <i class="pi pi-user absolute left-3 top-3 text-slate-400 text-sm"></i>
                <input
                  type="text"
                  id="firstName"
                  formControlName="first_name"
                  class="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 text-sm font-medium"
                  placeholder="John"
                  [class.border-red-300]="f.first_name.touched && f.first_name.invalid"
                />
              </div>
            </div>

            <div class="space-y-1">
              <label
                for="lastName"
                class="block text-[10px] font-bold text-slate-600 uppercase tracking-wider"
                >Last Name</label
              >
              <div class="relative">
                <i class="pi pi-user absolute left-3 top-3 text-slate-400 text-sm"></i>
                <input
                  type="text"
                  id="lastName"
                  formControlName="last_name"
                  class="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 text-sm font-medium"
                  placeholder="Doe"
                />
              </div>
            </div>
          </div>

          <!-- Email -->
          <div class="mb-7">
            <label
              for="email"
              class="block text-[10px] font-bold text-slate-600 uppercase tracking-wider"
              >Email Address</label
            >
            <div class="relative">
              <i class="pi pi-envelope absolute left-3 top-3 text-slate-400 text-sm"></i>
              <input
                type="email"
                id="email"
                formControlName="email"
                class="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 text-sm font-medium"
                placeholder="name@example.com"
              />
            </div>
          </div>

          <!-- Phone -->
          <div class="mb-7">
            <label
              for="phone"
              class="block text-[10px] font-bold text-slate-600 uppercase tracking-wider"
              >Phone Number</label
            >
            <div class="relative">
              <span
                class="absolute left-3 top-2.5 text-slate-500 font-bold text-sm border-r border-slate-300 pr-2"
                >+91</span
              >
              <input
                type="tel"
                id="phone"
                formControlName="phone"
                class="w-full pl-12 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 text-sm font-medium tracking-wide"
                placeholder="98765 43210"
                maxlength="10"
              />
            </div>
          </div>

          <!-- Password Row -->
          <div class="grid grid-cols-2 gap-3 mb-7">
            <div class="space-y-1">
              <label
                for="password"
                class="block text-[10px] font-bold text-slate-600 uppercase tracking-wider"
                >Password</label
              >
              <div class="relative">
                <i class="pi pi-lock absolute left-3 top-3 text-slate-400 text-sm"></i>
                <input
                  type="password"
                  id="password"
                  formControlName="password1"
                  class="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 text-sm font-medium"
                  placeholder="••••••••"
                />
              </div>
            </div>

            <div class="space-y-1">
              <label
                for="confirmPassword"
                class="block text-[10px] font-bold text-slate-600 uppercase tracking-wider"
                >Confirm</label
              >
              <div class="relative">
                <i class="pi pi-lock absolute left-3 top-3 text-slate-400 text-sm"></i>
                <input
                  type="password"
                  id="confirmPassword"
                  formControlName="password2"
                  class="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400 text-sm font-medium"
                  placeholder="••••••••"
                />
              </div>
            </div>
          </div>

          <!-- Error Message Block -->
          @if (registrationForm.errors?.['passwordMismatch'] && f.password2.touched) {
          <p class="text-red-500 text-xs flex items-center mt-1">
            <i class="pi pi-exclamation-circle mr-1"></i> Passwords do not match
          </p>
          } @if (serverError()) {
          <div
            class="bg-red-50 border border-red-100 text-red-600 p-2 rounded-lg text-xs flex items-center"
          >
            <i class="pi pi-info-circle mr-2 text-sm"></i> {{ serverError() }}
          </div>
          }

          <!-- Submit Button -->
          <button
            type="submit"
            [disabled]="registrationForm.invalid || loading()"
            class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 disabled:cursor-not-allowed text-white font-bold py-3 rounded-lg shadow-lg shadow-indigo-200 transition-all transform hover:-translate-y-0.5 active:scale-[0.98] text-sm"
          >
            @if(loading()) {
            <i class="pi pi-spin pi-spinner mr-2"></i> Creating... } @else { Create Free Account }
          </button>
        </form>

        <!-- Footer -->
        <p class="text-center text-xs text-slate-500 mt-6">
          Already have an account?
          <a
            routerLink="/login"
            class="font-bold text-indigo-600 hover:text-indigo-800 hover:underline transition-colors"
            >Sign In</a
          >
        </p>
      </div>
    </div>
  </div>
</div>
